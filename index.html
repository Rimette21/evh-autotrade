
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>E.V.H. Autotrade</title>

  <!-- Pr√©charge banni√®re -->
  <link rel="preload" as="image"
        href="images/Dubai_car (1).webp"
        imagesrcset="images/Dubai_car.webp 1x, images/Dubai_car@2x.webp 2x"
        imagesizes="100vw">

  <!-- CSS -->
  <link rel="stylesheet" href="styles.css?v=16">
  <link rel="stylesheet" href="mobile-tighten.css">
</head>
<body>

  <!-- HEADER (burger CSS-only) -->
  <header>
    <div class="header-inner">
      <div class="logo-wrap">
        <div class="logo">
          <img src="images/EVH_logo-removebg-preview.png" alt="E.V.H. AUTOTRADE">
        </div>
        <div class="brand">
          <span class="evh">E.V.H.</span>
          <span class="Autotrade">Autotrade</span>
        </div>
      </div>

      <nav class="nav" aria-label="Navigation principale">
        <ul>
          <li><a href="index.html">Accueil</a></li>
          <li><a href="#catalogue">Catalogue</a></li>
          <li><a href="#avantages">Avantages</a></li>
          <li><a href="about.html">√Ä propos</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="processus.html">Processus</a></li>
        </ul>
      </nav>

      <!-- Checkbox + bouton burger -->
      <input type="checkbox" id="nav-toggle" aria-hidden="true" />
      <label class="nav-btn" for="nav-toggle" aria-label="Ouvrir le menu">
        <span class="bar"></span>
      </label>

      <label for="nav-toggle" class="nav-overlay" aria-hidden="true"></label>
      <aside class="nav-drawer" role="dialog" aria-modal="true" aria-label="Menu mobile">
        <div class="drawer-head">
          <div class="drawer-title">Menu</div>
          <label for="nav-toggle" class="drawer-close" aria-label="Fermer">‚úï</label>
        </div>
        <div class="drawer-body">
          <nav class="drawer-nav">
            <ul>
              <li><a href="index.html">Accueil</a></li>
              <li><a href="#catalogue">Catalogue</a></li>
              <li><a href="#avantages">Avantages</a></li>
              <li><a href="about.html">√Ä propos</a></li>
              <li><a href="contact.html">Contact</a></li>
              <li><a href="processus.html">Processus</a></li>
            </ul>
          </nav>
        </div>
      </aside>
      <!-- fin des √©l√©ments qui doivent rester dans .header-inner -->
    </div>
  </header>

  <!-- H√âRO -->
  <section class="hero-static">
    <picture class="hero-bg">
      <source media="(max-width: 680px)" srcset="images/imagemobilemenu.webp" type="image/webp">
      <source srcset="images/imagecomputermenu.webp" type="image/webp">
      <img src="images/imagemobilemenu.webp" alt="EVH Autotrade ‚Äì Importation de SUV √©lectriques et hybrides" fetchpriority="high">
    </picture>
    <div class="bg-overlay"></div>
    <div class="hero-cta">
      <h2 class="adv2-title">Passez √† l'√©l√©ctrique sereinement</h2>
      <p class="maintext" style="margin-bottom:23px;margin-top:6px;padding-right:15px;">
        Prix FCR, Livraison incluse, Assistance de A √† Z jusqu‚Äôau port d'arriv√©e.
      </p>
      <a href="#catalogue" class="btn">D√©couvrez nos mod√®les</a>
    </div>
  </section>

  <!-- AVANTAGES -->
  <section id="avantages" class="advantages-lovable">
    <div class="adv2-head">
      <h2 class="adv2-title">Pourquoi choisir EVH AutoTrade ?</h2>
      <p class="adv2-sub">
        Avec EVH Auto Trade, vous achetez directement √† la source, sans interm√©diaires.
        Un service complet, du choix du mod√®le √† la livraison au port, avec un accompagnement personnalis√© √† chaque √©tape.
      </p>
    </div>
    <div class="adv2-grid">
      <article class="adv2-card">
        <div class="inner">
          <div class="adv2-badge">üåè</div>
          <div class="adv2-title-sm">Importation directe</div>
          <p class="adv2-desc">Prix r√©duits gr√¢ce √† notre r√©seau d'importation directe sans interm√©diaires.</p>
        </div>
      </article>
      <article class="adv2-card">
        <div class="inner">
          <div class="adv2-badge">üõ°Ô∏è</div>
          <div class="adv2-title-sm">SUV garantis 2 ans</div>
          <p class="adv2-desc">V√©hicules neufs ou r√©cents, contr√¥l√©s et couverts par une garantie importateur de 2 ans (extension possible jusqu‚Äô√† 5 ans, selon mod√®le).</p>
        </div>
      </article>
      <article class="adv2-card">
        <div class="inner">
          <div class="adv2-badge">‚öì</div>
          <div class="adv2-title-sm">Transport inclus au port</div>
          <p class="adv2-desc">Livraison sous 45 jours avec assistance au d√©douanement.</p>
        </div>
      </article>
    </div>
  </section>

  <!-- CATALOGUE -->
  <section id="catalogue" class="section--light">
    <p class="catalogue-note">
Les prix affich√©s d√©pendent du type de motorisation :
<br>‚Ä¢ <strong>V√©hicules 100% √©lectriques (BEV)</strong> : prix TTC ‚Äî d√©douanement compris ‚Äî pr√™ts √† immatriculer en Tunisie.
<br>‚Ä¢ <strong>V√©hicules hybrides & hybrides rechargeables (PHEV / HEV)</strong> : prix FCR (HT) ‚Äî hors d√©douanement, r√©gime RS applicable.
</p>

    <div class="adv2-head">
      <h2 class="adv2-title">D√©couvrez <span class="accent">Nos Mod√®les</span></h2>
    </div>

    <!-- FILTRES CATALOGUE (v2) -->
    <div id="filters" class="filters">
      <div class="filters-row">
        <!-- Recherche Marque/Mod√®le -->
        <input id="f-q" type="search" placeholder="Rechercher : marque ou mod√®le‚Ä¶" aria-label="Rechercher par marque/mod√®le">

        <!-- Motorisation -->
        <select id="f-type" aria-label="Filtrer par motorisation">
          <option value="">Motorisation</option>
          <option value="BEV">√âlectrique (BEV)</option>
          <option value="PHEV">Hybride rechargeable (PHEV)</option>
          <option value="HEV">Hybride (HEV)</option>
          <option value="ESSENCE">Essence</option>
          <option value="DIESEL">Diesel</option>
        </select>

        <!-- Ann√©e (slider) -->
        <div class="range-wrap">
          <label for="f-year" class="range-label">
            Ann√©e immat. : <span id="f-year-val">‚Äî</span>
          </label>
          <input id="f-year" type="range" min="2008" max="2026" step="1" value="2008" aria-label="Ann√©e d'immatriculation minimale">
        </div>

        <!-- Kilom√©trage (slider) -->
        <div class="range-wrap">
          <label for="f-km" class="range-label">
            Kilom√©trage max : <span id="f-km-val">‚Äî</span>
          </label>
          <input id="f-km" type="range" min="0" max="200000" step="1000" value="200000" aria-label="Kilom√©trage maximal">
        </div>

        <!-- Prix (slider) -->
        <div class="range-wrap">
          <label for="f-price" class="range-label">
            Prix FCR max : <span id="f-price-val">‚Äî</span>
          </label>
          <input id="f-price" type="range" min="0" max="100000" step="500" value="100000" aria-label="Prix maximal">
        </div>

        <button id="f-reset" class="btn btn--ghost" type="button">R√©initialiser</button>
      </div>
    </div>

    <div id="vehicles-grid" class="grid">
      <p>Chargement du catalogue‚Ä¶</p>
    </div>
  </section>

  <!-- ===== Helpers (quick-specs + puces dynamiques) ===== -->
  <script>
    // D√©termine l‚Äô√©nergie : PHEV si on d√©tecte un hybride rechargeable, sinon BEV
    function energyFrom(v){
      const hay = [v.name, ...(v.features||[])].join(' ').toLowerCase();
      if (/(phev|hybride\s*rechargeable|dm-i|plug[- ]?in)/i.test(hay)) return 'PHEV';
      if (/\bbev\b|100%\s*√©lectrique|fully electric/i.test(hay)) return 'BEV';
      return 'BEV';
    }
    // Format immat YYYY-MM
    function cleanReg(y){
      if(!y) return '‚Äî';
      const p=String(y).split('-');
      return p.length===2?`${p[0]}-${p[1]}`:p[0];
    }
    // Cylindr√©e depuis specs
    function engineCc(v){
      const s=v.specifications||{};
      return s.engineCc||s.enginecc||s.EngineCC||s.cylindree||'‚Äî';
    }
    // Sigle court transmission
    function transmissionShort(v){
      const t = (v.specifications && v.specifications.transmission) ? String(v.specifications.transmission) : '';
      const m =
        t.match(/\b(2?DHT)\b/i) ||
        t.match(/\bE[-\s]?CVT\b/i) ||
        t.match(/\bDCT\b/i) ||
        t.match(/\bAT\b/i) ||
        t.match(/\bMT\b/i) ||
        t.match(/\bSingle[-\s]?speed\b/i);
      return m ? m[0].toUpperCase().replace(/\s+/g,'-') : null;
    }
    // "Autonomie 110 km" √† partir de specs ‚Üí features ‚Üí name
    function autonomyLabel(v){
      const s = v.specifications || {};
      const candidates = [s.autonomieWLTP, s.autonomieCLTC, s.autonomieEPA, s.autonomieElectrique];
      for (const c of candidates){
        if (!c) continue;
        const m = String(c).match(/(\d{2,4})\s*km/i);
        if (m) return `Autonomie ${m[1]} km`;
      }
      const pool = [v.name, ...(v.features||[])].join(' | ');
      const m = pool.match(/(\d{2,4})\s*km/i);
      return m ? `Autonomie ${m[1]} km` : 'Autonomie ‚Äî';
    }
    // Ruban 5 infos sous l‚Äôimage ‚Äì version horizontale identique √† la page 2
    function quickSpecsHTML(v){
      const reg = cleanReg(v.regyear);
      const cc = engineCc(v);
      const km = (v.mileage != null) ? new Intl.NumberFormat('fr-FR').format(v.mileage) : '‚Äî';
      const fuel = energyFrom(v);
      const tr = transmissionShort(v) || '‚Äî';
      return `
        <div class="quick-specs">
          <div class="qs-col">
            <span class="qs-label">Reg. Year</span>
            <span class="qs-value">${reg}</span>
          </div>
          <div class="qs-col">
            <span class="qs-label">Engine(cc)</span>
            <span class="qs-value">${cc}</span>
          </div>
          <div class="qs-col">
            <span class="qs-label">Mlg(km)</span>
            <span class="qs-value">${km}</span>
          </div>
          <div class="qs-col">
            <span class="qs-label">Fuel</span>
            <span class="qs-value" style="color:#00aa00;font-weight:700;">${fuel}</span>
          </div>
          <div class="qs-col">
            <span class="qs-label">Transm.</span>
            <span class="qs-value">${tr}</span>
          </div>
        </div>`;
    }

    // ===== Helpers additionnels =====
    const EURO = new Intl.NumberFormat('fr-FR');
    function parsePriceEUR(s){
      if(!s) return null;
      const n = String(s).replace(/[^\d]/g,''); // "25 340 ‚Ç¨" -> "25340"
      return n ? parseInt(n,10) : null;
    }
    function brandFromName(name){
      if(!name) return '';
      const t = name.split(/\s+/).filter(Boolean);
      return /^\d{4}$/.test(t[0]) ? (t[1] || '') : t[0];
    }
    function yearFromReg(reg){
      if(!reg) return null;
      const y = String(reg).slice(0,4);
      return /^\d{4}$/.test(y) ? parseInt(y,10) : null;
    }
    function kmNum(v){
      return (v.mileage != null) ? parseInt(String(v.mileage).replace(/[^\d]/g,''),10) : 0;
    }
    function energyNormalized(v){
      const e = energyFrom(v).toUpperCase();
      if (e.includes('PHEV')) return 'PHEV';
      if (e.includes('BEV')) return 'BEV';
      if (/(HEV|hybride(?!.*rechargeable))/i.test([v.name, ...(v.features||[])].join(' '))) return 'HEV';
      if (/\bESSENCE\b|gasoline|petrol/i.test([v.name, ...(v.features||[])].join(' '))) return 'ESSENCE';
      if (/\bDIESEL\b/i.test([v.name, ...(v.features||[])].join(' '))) return 'DIESEL';
      return e || '';
    }
    // petite latence pour la recherche texte
    function debounce(fn, ms=250){
      let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
    }

    // >>> helper pour extraire les 4 caract√©ristiques du JSON (batterie, moteur √©lec, puissance syst√®me, recharge AC)
    function pickSpecFeatures(v){
      const feats = Array.isArray(v.features) ? v.features : [];
      const find = (re) => feats.find(s => re.test(s));

      const battery   = find(/batterie|battery/i);
      const motorElec = find(/moteur\s*(√©lectrique)?\s*\d+(\.\d+)?\s*(kW|ch)/i) || find(/puissance\s*moteur/i);
      const sysPower  = find(/puissance\s*(syst√®me|cumul√©e)/i);
      const acCharge  = find(/recharge\s*ac.*\d/i) || find(/\bac\s*\d+(\.\d+)?\s*kW/i);

      return [battery, motorElec, sysPower, acCharge].filter(Boolean);
    }

    // ===== Rendu d'une carte =====
    function cardHTML(v){
      const energy = energyFrom(v);
      const autoLbl = autonomyLabel(v);
      const trShort = transmissionShort(v) || '‚Äî';
      const newBadge = v.isNew ? `<span class="pill" style="position:absolute;left:10px;top:10px;z-index:2;background:#fef3c7;color:#92400e;border:1px solid #fde68a;">Neuf</span>` : '';

      // puce 1 : type √©nergie ; puce 2 : autonomie
      const energyLabel = (energy === 'PHEV') ? 'Hybride rechargeable (PHEV)' : '100% √©lectrique (BEV)';
      const specLines = pickSpecFeatures(v);

      // fallback si aucune des 4 n‚Äôest trouv√©e
      const fallbacks = [`Transmission auto ${trShort}`, 'Cam√©ra 360¬∞', 'Toit panoramique'];

      const items = [energyLabel, autoLbl, ...(specLines.length ? specLines : fallbacks)];

      return `
        <a class="card-link" href="vehicle.html?id=${encodeURIComponent(v.id)}">
          <article class="card" style="position:relative">
            ${newBadge}
            <img class="thumb" src="${v.images?.hero || ''}" alt="${v.name}"
                 onerror="this.src='https://via.placeholder.com/400x300?text=Image+non+disponible'">
            ${quickSpecsHTML(v)}
            <div class="body">
              <div class="name">${v.name}</div>
              <div class="submeta">R√©f : <strong>${v.id}</strong></div>
              <div class="price">Prix FCR (HT) : ${v.priceFCR || '-'}</div>
              <ul class="features">
                ${items.map(x=>`<li>‚Ä¢ ${x}</li>`).join('')}
              </ul>
            </div>
          </article>
        </a>`;
    }

    function renderGrid(list){
      const grid = document.getElementById('vehicles-grid');
      if(!Array.isArray(list) || list.length === 0){
        grid.innerHTML = '<p>Aucun v√©hicule ne correspond aux filtres.</p>';
        return;
      }
      grid.innerHTML = list.map(cardHTML).join('');
    }

    // ===== Filtrage principal =====
    function applyFilters(){
      const q = document.getElementById('f-q').value.trim().toLowerCase();
      const type = document.getElementById('f-type').value;     // BEV/PHEV/HEV/ESSENCE/DIESEL/''
      const yMin = parseInt(document.getElementById('f-year').value,10);
      const kmMax = parseInt(document.getElementById('f-km').value,10);
      const pMax = parseInt(document.getElementById('f-price').value,10);

      const filtered = window.__VEHICLES__.filter(v => {
        const name = (v.name||'').toLowerCase();
        const brand = brandFromName(v.name).toLowerCase();
        const hay = [name, brand, ...(v.features||[])].join(' ').toLowerCase();
        const okQ = !q || hay.includes(q);

        const e = energyNormalized(v);           // normalis√©
        const okType = !type || e === type;

        const y = yearFromReg(v.regyear) || 1900;
        const okYear = y >= yMin;

        const km = kmNum(v);
        const okKm = isFinite(kmMax) ? km <= kmMax : true;

        const price = parsePriceEUR(v.priceFCR) || 0;
        const okPrice = isFinite(pMax) ? price <= pMax : true;

        return okQ && okType && okYear && okKm && okPrice;
      });

      renderGrid(filtered);
      // maj √©tiquettes sliders
      document.getElementById('f-year-val').textContent = yMin;
      document.getElementById('f-km-val').textContent = EURO.format(kmMax) + ' km';
      document.getElementById('f-price-val').textContent = EURO.format(pMax) + ' ‚Ç¨';
    }

    // ===== Initialisation =====
    fetch('data/hero.json?v=12', { cache: 'no-store' })
      .then(res => res.json())
      .then(vehicles => {
        window.__VEHICLES__ = vehicles || [];

        // bornes dynamiques
        const years = window.__VEHICLES__.map(v => yearFromReg(v.regyear)).filter(Boolean);
        const kms = window.__VEHICLES__.map(kmNum).filter(n => !isNaN(n));
        const prices = window.__VEHICLES__.map(v => parsePriceEUR(v.priceFCR)).filter(n => !isNaN(n));

        const yMin = Math.min(...(years.length?years:[2015]));
        const yMax = Math.max(...(years.length?years:[(new Date()).getFullYear()]));
        const kmMax = Math.max(...(kms.length?kms:[200000]));
        const pMax = Math.max(...(prices.length?prices:[40000]));

        const elYear = document.getElementById('f-year');
        elYear.min = yMin; elYear.max = yMax; elYear.value = yMin;
        document.getElementById('f-year-val').textContent = yMin;

        const elKm = document.getElementById('f-km');
        elKm.min = 0; elKm.max = kmMax; elKm.step = 1000; elKm.value = kmMax;
        document.getElementById('f-km-val').textContent = EURO.format(kmMax) + ' km';

        const elPrice = document.getElementById('f-price');
        elPrice.min = 0; elPrice.max = pMax; elPrice.step = 500; elPrice.value = pMax;
        document.getElementById('f-price-val').textContent = EURO.format(pMax) + ' ‚Ç¨';

        // Rendu initial
        renderGrid(window.__VEHICLES__);

        // Listeners
        const onInput = debounce(applyFilters, 200);
        document.getElementById('f-q').addEventListener('input', onInput);
        document.getElementById('f-type').addEventListener('change', applyFilters);
        elYear.addEventListener('input', applyFilters);
        elKm.addEventListener('input', applyFilters);
        elPrice.addEventListener('input', applyFilters);

        document.getElementById('f-reset').addEventListener('click', () => {
          document.getElementById('f-q').value = '';
          document.getElementById('f-type').value = '';
          elYear.value = yMin;
          elKm.value = kmMax;
          elPrice.value = pMax;
          applyFilters();
        });
      })
      .catch(err => {
        console.error(err);
        document.getElementById('vehicles-grid').innerHTML =
          '<p style="color:red;">Erreur : impossible de charger le catalogue.</p>';
      });
  </script>

  <section id="avantages" class="advantages-lovable">
    <div class="adv2-head">
      <h2 class="adv2-title">Besoin d‚Äôun conseil ou d‚Äôun devis rapide ?</h2>
      <p class="adv2-sub">Notre √©quipe vous r√©pond rapidement par mail, WhatsApp ou t√©l√©phone pour vous aider √† choisir le bon SUV.</p>
      <p class="adv2-sub" style="padding:15px;">üì© Mail : contact@evhautotrade.com</p>
      <p class="adv2-sub">üí¨ WhatsApp : +33 6 50 44 74 00</p>
      <a href="mailto:contact@evhautotrade.com" class="btn contact" style="margin-top:23px;">Contactez Nous</a>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-wrap">
      <div class="f-brand">
        <img src="images/EVH_logo.png" alt="EVH Autotrade" class="f-logo">
        <div>
          <strong>Eco Value Hub FZ-LLC</strong><br>
          Free Zone Limited Liability Company (FZ-LLC) ‚Äì General Trading Licence<br>
          VUNE1173, Compass building ‚Äì Al Hulaila, AL Hulaila Industrial Zone-FZ,<br>
          Ras Al Khaimah, United Arab Emirates
        </div>
      </div>
      <div class="f-cols">
        <div class="f-col">
          <h4>Contact</h4>
          <ul>
            <li><a href="mailto:contact@evhautotrade.com">contact@evhautotrade.com</a></li>
            <li><a href="https://wa.me/33650447400" rel="noopener" target="_blank">WhatsApp : +33 6 50 44 74 00</a></li>
          </ul>
        </div>
        <div class="f-col">
          <h4>Informations l√©gales</h4>
          <ul>
            <li><a href="mentions-legales.html">Mentions l√©gales</a></li>
            <li><a href="conditions-generales.html">Conditions g√©n√©rales</a></li>
            <li><a href="confidentialite.html">Confidentialit√©</a></li>
          </ul>
        </div>
        <div class="f-col">
          <h4>EVH Autotrade</h4>
          <ul>
            <li><a href="index.html#catalogue">Catalogue</a></li>
            <li><a href="index.html#avantages">Nos avantages</a></li>
            <li><a href="mailto:contact@evhautotrade.com?subject=Demande%20devis">Demander un devis</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="f-bottom">
      <small>¬© <span id="y"></span> Eco Value Hub FZ-LLC ‚Äî All rights reserved.</small>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
