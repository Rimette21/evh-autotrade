<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>D√©tail v√©hicule ‚Äî E.V.H. AUTOTRADE</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Open Sans', sans-serif; background:#e5b34a; color:#333; line-height:1.6; }
    header { background:#1a1f25; color:#fff; padding:0.75rem 2rem; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 8px rgba(0,0,0,.1); }
    .logo-container { display:flex; align-items:center; gap:1rem; }
    .logo img { height:60px; }
    .logo-text { display:flex; align-items:center; gap:.25rem; }
    .logo-text .evh { font-size:1.5rem; font-weight:800; letter-spacing:1px; color:#fff; }
    .logo-text .autotrade { font-size:1.5rem; font-weight:800; color:#e53e3e; }
    nav ul { display:flex; list-style:none; gap:1.5rem; }
    nav a { color:#fff; text-decoration:none; font-weight:500; font-size:.95rem; }

    .container { max-width:1200px; margin:2rem auto; padding:0 1.5rem; }
    .back-link { display:inline-block; color:#1a1f25; text-decoration:none; font-weight:600; margin-bottom:1rem; }
    .back-link:hover { text-decoration:underline; }

    .vehicle-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:2rem; }
    .vehicle-title { flex:1; }
    .vehicle-title h1 { font-size:1.8rem; color:#1a1f25; margin-bottom:.5rem; }
    .vehicle-price { font-size:1.4rem; color:#e53e3e; font-weight:bold; margin-left:2rem; }
    .vehicle-meta { font-size:.95rem; color:#666; margin-top:.5rem; }

    .content-grid { display:grid; grid-template-columns:1fr 1fr; gap:2rem; }
    .image-section, .specs-section, .equip-section, .button-section, .features-section {
      background:#fff; border-radius:12px; padding:1.5rem; box-shadow:0 2px 8px rgba(0,0,0,.1);
    }
    .hero-img { width:100%; max-height:400px; object-fit:cover; border-radius:8px; margin-bottom:1rem; }
    .gallery { display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:.75rem; }
    .gallery img { width:100%; height:100px; object-fit:cover; border-radius:6px; cursor:pointer; }

    .specs-section h2, .equip-section h2, .features-section h2 { color:#1a1f25; margin-bottom:1rem; font-size:1.4rem; }
    .specs-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    .spec-item { display:flex; justify-content:space-between; font-size:.95rem; }

    .equip-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    .equip-list { list-style:none; padding-left:0; }
    .equip-list li { margin-bottom:.4rem; padding-left:1.2rem; position:relative; }
    .equip-list li::before { content:"‚Ä¢"; color:#e53e3e; position:absolute; left:0; font-weight:bold; }

    .button-section { text-align:center; }
    .btn-devise { display:block; width:100%; background:#e53e3e; color:#fff; text-align:center; padding:.75rem; border-radius:8px; text-decoration:none; font-weight:600; font-size:1.1rem; transition:background .3s; }
    .btn-devise:hover { background:#c53030; }

    .features-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    .feature-item { display:flex; align-items:center; font-size:.95rem; }
    .feature-icon { margin-right:.5rem; color:#e53e3e; }

    @media (max-width:768px){
      .content-grid { grid-template-columns:1fr; }
      .vehicle-header { flex-direction:column; gap:1rem; }
      .vehicle-price { margin-left:0; margin-top:1rem; }
      .specs-grid, .equip-grid, .features-grid { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <div class="logo">
        <!-- chemin RELATIF (GitHub Pages projet) -->
        <img src="images/EVH_logo.png" alt="E.V.H. AUTOTRADE">
      </div>
      <div class="logo-text">
        <span class="evh">E.V.H.</span>
        <span class="autotrade">AUTOTRADE</span>
      </div>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="index.html">Catalogue</a></li>
        <li><a href="#">Avantages</a></li>
        <li><a href="#">Acheter</a></li>
        <li><a href="#">√Ä propos</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <a href="index.html" class="back-link">‚Üê Retour au catalogue</a>
    <div id="vehicle-detail"><p>Chargement du v√©hicule...</p></div>
  </div>

  <script>
    // --- helpers ---
    const placeholderHero = 'https://via.placeholder.com/1200x800?text=Image+indisponible';
    const placeholderThumb = 'https://via.placeholder.com/300x200?text=Miniature';

    const fixPath = (p) => {
      if (!p) return p;
      if (/^https?:\/\//i.test(p)) return p;    // URL absolue OK
      return p.replace(/^\//, '');              // supprime / initial -> relatif au projet
    };

    const fmt = (n) => {
      const num = Number(n ?? 0);
      try { return num.toLocaleString('fr-FR'); } catch { return String(num); }
    };

    const getYear = (reg) => (reg || '').split('-')[0] || '';

    // --- main ---
    const id = new URLSearchParams(location.search).get('id');
    const mount = document.getElementById('vehicle-detail');

    if (!id) {
      mount.innerHTML = `
        <div style="background:#fff3f3; color:#d32f2f; padding:2rem; border-radius:12px; text-align:center;">
          <h2>Erreur</h2>
          <p>Aucun v√©hicule s√©lectionn√©.</p>
          <a href="index.html" style="color:#e53e3e; text-decoration:none; font-weight:600;">‚Üê Retour au catalogue</a>
        </div>`;
    } else {
      (async () => {
        try {
          const url = `data/details/${encodeURIComponent(id)}.json`;
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status} sur ${url}`);
          const data = await res.json();

          // fallback FR/EN pour les cl√©s
          const features = data.features || data.caracteristiques || [];
          const equip = data.equipment || data.equipements || {};
          const gallery = Array.isArray(data.images?.gallery) ? data.images.gallery.map(fixPath) : [];
          const hero = fixPath(data.images?.hero) || placeholderHero;

          // type carburant simple (d√©duit des features)
          const joined = features.join(' ').toLowerCase();
          const fuel = joined.includes('hybride') ? 'PHEV' : 'BEV';

          // specs -> tableau cl√©/valeur (aplatit les objets imbriqu√©s)
          const specs = data.specifications || {};
          const specItems = [];
          for (const [k, v] of Object.entries(specs)) {
            if (v && typeof v === 'object' && !Array.isArray(v)) {
              for (const [sk, sv] of Object.entries(v)) specItems.push({ label: sk, value: sv });
            } else {
              specItems.push({ label: k, value: v });
            }
          }

          const allEquip = [
            ...(equip.interieur || equip.interior || []),
            ...(equip.securite || equip.safety || []),
            ...(equip.connectivite || equip.connectivity || [])
          ];

          const half = Math.ceil(allEquip.length / 2);

          mount.innerHTML = `
            <div class="vehicle-header">
              <div class="vehicle-title">
                <h1>${data.name || ''}</h1>
                <div class="vehicle-meta">Mod√®le ${getYear(data.regyear)} - R√©f: ${data.id || ''}</div>
              </div>
              <div class="vehicle-price">Prix FCR (HT) : ${data.priceFCR || ''}</div>
            </div>

            <div class="content-grid">
              <div class="image-section">
                <img src="${hero}" alt="${data.name || 'V√©hicule'}" class="hero-img"
                     onerror="this.src='${placeholderHero}'">
                <div class="gallery">
                  ${
                    gallery.length
                      ? gallery.map(u => `
                          <img src="${u}" alt="Vue du v√©hicule"
                               onerror="this.src='${placeholderThumb}'"
                               onclick="window.open('${u}','_blank')">
                        `).join('')
                      : '<p>Aucune image suppl√©mentaire disponible.</p>'
                  }
                </div>
              </div>

              <div class="specs-section">
                <h2>Sp√©cifications techniques</h2>
                ${
                  specItems.length
                    ? `<div class="specs-grid">
                        ${specItems.map(it => `
                          <div class="spec-item">
                            <span>${it.label}:</span>
                            <strong>${it.value ?? ''}</strong>
                          </div>`).join('')}
                      </div>`
                    : '<p>Non sp√©cifi√©es.</p>'
                }
              </div>
            </div>

            <div class="features-section">
              <h2>Caract√©ristiques principales</h2>
              <div class="features-grid">
                <div class="feature-item">
                  <span class="feature-icon">üìÖ</span>
                  <span>Ann√©e: ${getYear(data.regyear)}</span>
                </div>
                <div class="feature-item">
                  <span class="feature-icon">‚õΩ</span>
                  <span>Carburant: ${fuel}</span>
                </div>
                <div class="feature-item">
                  <span class="feature-icon">üîã</span>
                  <span>Batterie: ${specs.capaciteBatterie || specs.battery || 'Non sp√©cifi√©'}</span>
                </div>
                <div class="feature-item">
                  <span class="feature-icon">üìè</span>
                  <span>Kilom√©trage: ${fmt(data.mileage)} km</span>
                </div>
              </div>
            </div>

            <div class="equip-section">
              <h2>√âquipements & Accessoires</h2>
              ${
                allEquip.length
                  ? `<div class="equip-grid">
                      <ul class="equip-list">${allEquip.slice(0, half).map(li => `<li>${li}</li>`).join('')}</ul>
                      <ul class="equip-list">${allEquip.slice(half).map(li => `<li>${li}</li>`).join('')}</ul>
                    </div>`
                  : '<p>Aucun √©quipement list√©.</p>'
              }
            </div>

            <div class="button-section">
              <a href="#" class="btn-devise">Demander un devis pour ce v√©hicule</a>
            </div>
          `;
        } catch (err) {
          console.error('Erreur chargement v√©hicule:', err);
          mount.innerHTML = `
            <div style="background:#fff3f3; color:#d32f2f; padding:2rem; border-radius:12px; text-align:center;">
              <h2>V√©hicule non trouv√©</h2>
              <p>ID : ${id}</p>
              <p>Le fichier n‚Äôexiste pas ou a √©t√© supprim√©.</p>
              <a href="index.html" style="color:#e53e3e; text-decoration:none; font-weight:600;">‚Üê Retour au catalogue</a>
            </div>`;
        }
      })();
    }
  </script>
</body>
</html>
